{% extends 'App_QR/base.html' %}
{% load static %}

{% block title %}Crear Turno{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'App_QR/css/form.css' %}">
{% endblock %}

{% block content %}
<div class="form-container">
    <h2>üìù Crear Nuevo Turno</h2>
    
    <form method="post">
        {% csrf_token %}
        
        <div class="form-group">
            <label for="cliente_documento">N√∫mero de Documento *</label>
            <div style="display:flex;gap:8px;align-items:center;">
                <input type="text" id="cliente_documento" name="cliente_documento" value="{% if cliente_prefill %}{{ cliente_prefill.documento }}{% else %}{{ request.POST.cliente_documento }}{% endif %}" required>
                <button type="submit" name="buscar" class="btn" formnovalidate>Buscar</button>
            </div>
            <small class="hint">Ingrese el n√∫mero de documento y presione Buscar para autocompletar desde clientes.</small>
        </div>

        <div style="margin-top:8px;">
            <label for="cliente_id">Cliente existente (opcional)</label>
            <select id="cliente_id" name="cliente_id">
                <option value="">-- Seleccionar cliente --</option>
                {% for c in clientes %}
                <option value="{{ c.pk }}" {% if cliente_prefill and cliente_prefill.id == c.pk %}selected{% endif %}>{{ c.nombre }}{% if c.documento %} ‚Äî {{ c.documento }}{% endif %}</option>
                {% endfor %}
            </select>
        </div>

        <div class="form-group">
            <label for="cliente_nombre">Nombre del Cliente *</label>
            <input type="text" id="cliente_nombre" name="cliente_nombre" value="{% if cliente_prefill %}{{ cliente_prefill.nombre }}{% else %}{{ request.POST.cliente_nombre }}{% endif %}" {% if cliente_prefill %}disabled{% endif %} required>
            {% if cliente_prefill %}
            <input type="hidden" name="cliente_nombre" value="{{ cliente_prefill.nombre }}">
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="cliente_email">Email</label>
            <input type="email" id="cliente_email" name="cliente_email" value="{% if cliente_prefill %}{{ cliente_prefill.email }}{% else %}{{ request.POST.cliente_email }}{% endif %}" {% if cliente_prefill %}disabled{% endif %}>
            {% if cliente_prefill %}
            <input type="hidden" name="cliente_email" value="{{ cliente_prefill.email }}">
            {% endif %}
        </div>
        
        <div class="form-group">
            <label for="cliente_telefono">Tel√©fono</label>
            <input type="tel" id="cliente_telefono" name="cliente_telefono" value="{% if cliente_prefill %}{{ cliente_prefill.telefono }}{% else %}{{ request.POST.cliente_telefono }}{% endif %}" {% if cliente_prefill %}disabled{% endif %}>
            {% if cliente_prefill %}
            <input type="hidden" name="cliente_telefono" value="{{ cliente_prefill.telefono }}">
            {% endif %}
        </div>
        
        <div class="form-group">
            <label>Tipo de Servicio *</label>
            <div class="service-buttons">
                {% for value, display in servicio_choices %}
                <div class="service-item">
                    <input type="radio" id="servicio_{{ forloop.counter }}" name="servicio" value="{{ value }}" class="service-radio" {% if request.POST.servicio == value %}checked{% endif %} required>
                    <label for="servicio_{{ forloop.counter }}" class="service-btn">{{ display }}</label>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="form-group">
            <label for="observaciones">Observaciones</label>
            <textarea id="observaciones" name="observaciones"></textarea>
        </div>
        
        <div class="form-actions">
            <button type="submit" name="crear" class="btn btn-success">Crear Turno</button>
            <a href="{% url 'home' %}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>
</div>
{% endblock %}
